import React, { useEffect, useState } from "react";
import { Layout, Navbar } from "~/components";
import Head from "next/head";
import { authenticateRoute } from "~/lib/authenticate";
import { IUserModel, MODAL_FORM_JASA } from "./utils/types";
import { fetchUserDetail } from "./utils/api";
import styles from "./ProfilePage.module.scss";
import ProfileUserCard from "./ProfileUserCard";
import FormUpdateProfile from "./FormUpdateProfile";
import DefaultButton from "~/components/button/DefaultButton";
import ProfilePageListJasa from "./ProfilePageListJasa";
import { openModal } from "~/components/modal/DefaultModal";
import ProfilePageFormJasa from "./ProfilePageFormJasa";

const initialUser: IUserModel = {
  name: "",
  city: "",
  no_hp: "",
  image: "",
  description: "",
  email: "",
};

function ProfilePage() {
  const [user, setUser] = useState<IUserModel>(initialUser);

  const fetchUser = async () => {
    try {
      const response = await fetchUserDetail();
      if (response.state) {
        setUser(response.data);
      }
    } catch (error) {
      setUser(initialUser);
    }
  };

  useEffect(() => {
    fetchUser();
  }, []);

  return (
    <>
      <Head>
        <title>Profle | Lofiators</title>
        <meta name='description' content='Generated by create next app' />
        <link rel='icon' href='/favicon.ico' />
      </Head>

      <Navbar />

      <Layout classNames={styles.ProfilePage}>
        <section className={styles.ProfilePageUser}>
          <ProfileUserCard
            name={user.name}
            city={user.city}
            email={user.email}
            image={user.image}
            no_hp={user.no_hp}
            description={user.description}
          />
        </section>

        <section className={styles.ProfilePageJasa}>
          <div className='flex justify-between h-8 mb-4'>
            <div>
              <p className='text-base font-medium'>List Jasa</p>
            </div>
            <DefaultButton
              label='Tambah'
              className='bg-indigo-500 hover:bg-indigo-700'
              onClick={() => openModal(MODAL_FORM_JASA)}
            />
          </div>

          <ProfilePageListJasa />
        </section>
      </Layout>

      <FormUpdateProfile user={user} fetchUser={fetchUser} />
      <ProfilePageFormJasa />
    </>
  );
}

export default authenticateRoute(ProfilePage);
